---
import { css } from '@styled-system/css'
import focusRing from '@recipes/focusRing'
import { Image } from 'astro:assets'
import type { CollectionEntry } from 'astro:content'
import { photoPath } from 'astro-path-helpers/generated'

interface Props {
  photo: CollectionEntry<'photos'>
}

const { photo } = Astro.props
---

<li
  class={css({
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    gridRow: 1,
    borderRadius: 'bento',

    sm: {
      gridRow: 'auto',
      aspectRatio: '1 / 1',
      padding: '4',
      backgroundColor: 'stark.background',
    },
  })}
>
  <a
    href={photoPath(photo.id)}
    style={`aspect-ratio: ${photo.data.image.src.width / photo.data.image.src.height};`}
    aria-label="Open image"
    class:list={[
      focusRing(),
      css({
        cursor: 'zoom-in',
        display: 'block',

        height: '100vw',
        position: 'relative',
        overflow: 'hidden',
        sm: {
          height: 'auto',
          maxHeight: '100%',
          maxWidth: '100%',
          boxShadow: '0 0 0 2px {colors.stark.foreground}',
        },
        _focusVisible: {
          '& img': {
            transform: 'scale(1.05)',
            filter: 'brightness(1.05)',
          },
        },
      }),
    ]}
  >
    <Image
      src={photo.data.image.src}
      alt={photo.data.image.description}
      quality={60}
      height="450"
      densities={[1.5, 2]}
      transition:name={`photo-${photo.id}`}
      class={css({
        width: '100%',
        transition: 'all 0.3s',
        transitionTimingFunction: 'cubic-bezier(0.23, 1, 0.32, 1)',

        _supportsHover: {
          _hover: {
            transform: 'scale(1.05)',
            filter: 'brightness(1.05)',
          },
        },
      })}
    />
    <span class={css({ srOnly: true })}>Open image: {photo.data.title}</span>
  </a>
</li>
